# üîß Guia de Solu√ß√£o de Problemas - Sistema MRP Avan√ßado

## üéØ Problemas Comuns e Solu√ß√µes

### 1. üö® Duplica√ß√£o de Lotes (RESOLVIDO)

**‚ö†Ô∏è Problema**: Batches com datas de pedido e chegada id√™nticas

```json
// PROBLEMA - Antes da corre√ß√£o
{
    "batches": [
        {
            "order_date": "2025-05-01",
            "arrival_date": "2025-07-10",
            "quantity": 9506.087
        },
        {
            "order_date": "2025-05-01",  // ‚ùå DUPLICADO
            "arrival_date": "2025-07-10", // ‚ùå DUPLICADO
            "quantity": 4800
        }
    ]
}
```

**‚úÖ Solu√ß√£o Implementada**:
- Reescrita completa da estrat√©gia de lead time longo
- Elimina√ß√£o da l√≥gica de lotes de emerg√™ncia duplicados
- Sequenciamento inteligente de lotes

```json
// SOLU√á√ÉO - Ap√≥s corre√ß√£o
{
    "batches": [
        {
            "order_date": "2025-05-01",
            "arrival_date": "2025-07-10",
            "quantity": 10000
        },
        {
            "order_date": "2025-06-14",  // ‚úÖ √öNICO
            "arrival_date": "2025-08-23", // ‚úÖ √öNICO
            "quantity": 10000
        }
    ]
}
```

---

### 2. ‚è∞ Stockouts em Lead Times Longos

**‚ö†Ô∏è Problema**: Lotes chegam depois das demandas cr√≠ticas

**üîç Diagn√≥stico**:
```bash
# Verificar se lead time √© maior que janela dispon√≠vel
lead_time_days = 70
available_days = (primeira_demanda - start_cutoff).days
if lead_time_days > available_days:
    print("‚ö†Ô∏è Lead time cr√≠tico detectado")
```

**‚úÖ Solu√ß√µes**:

1. **Compensa√ß√£o por Atraso Autom√°tica**:
```python
if first_batch_arrival >= first_demand_date:
    days_late = (first_batch_arrival - first_demand_date).days
    compensation = first_demand_qty * (1 + days_late * 0.1)
```

2. **Ajuste de Par√¢metros**:
```json
{
    "safety_days": 5,           // Aumentar dias de seguran√ßa
    "safety_margin_percent": 15, // Aumentar margem
    "start_cutoff_date": "2025-04-01" // Antecipar cutoff
}
```

3. **Lead Time de Emerg√™ncia**:
```json
{
    "leadtime_days": 45,  // Reduzir se poss√≠vel
    "setup_cost": 500,    // Aceitar maior custo para urg√™ncia
    "express_delivery": true // Par√¢metro customizado
}
```

---

### 3. üí∞ Custos Excessivos de Manuten√ß√£o

**‚ö†Ô∏è Problema**: `holding_cost_impact` muito alto nos lotes

**üîç Identifica√ß√£o**:
```json
{
    "analytics": {
        "holding_cost_impact": 37503.47,  // ‚ùå Muito alto
        "setup_cost_allocation": 250      // OK
    }
}
```

**‚úÖ Solu√ß√µes**:

1. **Ajustar Taxa de Manuten√ß√£o**:
```json
{
    "holding_cost_rate": 0.10,  // Reduzir de 0.20 para 0.10
    "enable_consolidation": true // Ativar consolida√ß√£o
}
```

2. **Otimizar Tamanho dos Lotes**:
```json
{
    "min_batch_size": 1000,     // Aumentar m√≠nimo
    "max_batch_size": 8000,     // Reduzir m√°ximo
    "setup_cost": 500           // Aumentar para favorecer lotes maiores
}
```

---

### 4. üìâ Taxa de Atendimento Baixa

**‚ö†Ô∏è Problema**: `demand_fulfillment_rate` abaixo de 90%

**üîç An√°lise**:
```json
{
    "demand_fulfillment_rate": 66.67,
    "demands_unmet_count": 1,
    "unmet_demand_details": [
        {
            "date": "2025-07-07",
            "demand": 4000,
            "shortage": 4000
        }
    ]
}
```

**‚úÖ Solu√ß√µes**:

1. **Estrat√©gia Preventiva**:
```json
{
    "strategy": "preventive_stocking",
    "initial_stock": 3000,      // Aumentar estoque inicial
    "safety_margin_percent": 20 // Aumentar margem
}
```

2. **Multiple Suppliers**:
```json
{
    "suppliers": [
        {"leadtime_days": 30, "cost_multiplier": 1.2},
        {"leadtime_days": 70, "cost_multiplier": 1.0}
    ]
}
```

---

### 5. üîÑ Problemas de Consolida√ß√£o

**‚ö†Ô∏è Problema**: Consolida√ß√£o n√£o funciona adequadamente

**üîç Diagn√≥stico**:
```json
{
    "consolidation_savings": 0,
    "holding_cost_increase": 5000,
    "net_benefit": -5000  // ‚ùå Negativo
}
```

**‚úÖ Solu√ß√µes**:

1. **Ajustar Par√¢metros de Consolida√ß√£o**:
```json
{
    "enable_consolidation": true,
    "consolidation_window_days": 14,    // Reduzir janela
    "min_consolidation_benefit": 100,   // Reduzir benef√≠cio m√≠nimo
    "force_consolidation_within_leadtime": true
}
```

2. **Configura√ß√£o Avan√ßada**:
```json
{
    "operational_efficiency_weight": 1.5,  // Aumentar peso operacional
    "overlap_prevention_priority": true,   // Priorizar preven√ß√£o
    "setup_cost": 400                      // Aumentar para favorecer consolida√ß√£o
}
```

---

### 6. üìä Analytics Incompletos

**‚ö†Ô∏è Problema**: Campos de analytics ausentes ou zerados

**üîç Verifica√ß√£o**:
```python
def verify_analytics(result):
    required_fields = [
        'summary', 'stock_evolution', 'critical_points',
        'production_efficiency', 'demand_analysis'
    ]
    for field in required_fields:
        if field not in result['analytics']:
            print(f"‚ùå Campo ausente: {field}")
```

**‚úÖ Solu√ß√µes**:

1. **Dados M√≠nimos Necess√°rios**:
```json
{
    "sporadic_demand": {
        "2025-07-01": 1000  // M√≠nimo 1 demanda
    },
    "initial_stock": 100,    // > 0
    "leadtime_days": 1       // > 0
}
```

2. **Verificar Compatibilidade**:
```bash
# Verificar se advanced_sporadic_mrp.py est√° dispon√≠vel
python -c "from advanced_sporadic_mrp import AdvancedSporadicMRPPlanner; print('‚úÖ OK')"
```

---

### 7. üåê Problemas de API

**‚ö†Ô∏è Problema**: Erro 500 - Internal Server Error

**üîç Log de Debug**:
```bash
# Verificar logs do servidor
tail -f /var/log/mrp_server.log

# Testar conectividade
curl -X POST http://localhost:5000/mrp_advanced \
  -H "Content-Type: application/json" \
  -d '{"test": true}'
```

**‚úÖ Solu√ß√µes**:

1. **Valida√ß√£o de Entrada**:
```python
def validate_input(data):
    required = ['sporadic_demand', 'initial_stock', 'leadtime_days']
    for field in required:
        if field not in data:
            raise ValueError(f"Campo obrigat√≥rio: {field}")
    
    if not isinstance(data['sporadic_demand'], dict):
        raise ValueError("sporadic_demand deve ser um objeto")
```

2. **Tratamento de Erros**:
```python
try:
    result = mrp_planner.calculate(data)
except Exception as e:
    return {
        "error": True,
        "message": str(e),
        "fallback_strategy": "basic_mrp"
    }
```

---

### 8. üéØ Classifica√ß√£o ABC/XYZ Incorreta

**‚ö†Ô∏è Problema**: Classifica√ß√µes n√£o fazem sentido para o neg√≥cio

**üîç Verifica√ß√£o**:
```json
{
    "analytics": {
        "abc_classification": "C",  // ‚ùå Deveria ser A
        "xyz_classification": "Z"   // ‚ùå Deveria ser X
    }
}
```

**‚úÖ Solu√ß√µes**:

1. **Configurar Valores Unit√°rios**:
```json
{
    "unit_cost": 150.0,          // Especificar custo real
    "value_threshold_a": 0.8,    // 80% para classe A
    "variability_threshold_x": 0.15  // 15% para classe X
}
```

2. **Classifica√ß√£o Manual**:
```json
{
    "force_classification": {
        "abc": "A",
        "xyz": "X"
    }
}
```

---

### 9. üìà Performance Lenta

**‚ö†Ô∏è Problema**: Resposta do endpoint muito lenta (>10 segundos)

**üîç Profiling**:
```python
import time
start = time.time()
result = requests.post('/mrp_advanced', json=data)
print(f"Tempo: {time.time() - start:.2f}s")
```

**‚úÖ Otimiza√ß√µes**:

1. **Limitar Per√≠odo**:
```json
{
    "period_start_date": "2025-06-01",
    "period_end_date": "2025-12-31",  // M√°ximo 12 meses
    "max_demand_points": 50           // Limitar pontos de demanda
}
```

2. **Configura√ß√£o Simples**:
```json
{
    "enable_consolidation": false,    // Desabilitar se desnecess√°rio
    "enable_seasonality_detection": false,
    "enable_abc_xyz_classification": false
}
```

---

### 10. üîê Problemas de CORS

**‚ö†Ô∏è Problema**: Erro de CORS em aplica√ß√µes web

```javascript
// ‚ùå Erro t√≠pico
fetch('http://localhost:5000/mrp_advanced', {
    method: 'POST',
    body: JSON.stringify(data)
})
// CORS error: No 'Access-Control-Allow-Origin' header
```

**‚úÖ Solu√ß√£o**:

1. **Configurar CORS no Servidor**:
```python
from flask_cors import CORS
app = Flask(__name__)
CORS(app, origins=['http://localhost:3000'])
```

2. **Headers Corretos**:
```javascript
fetch('http://localhost:5000/mrp_advanced', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
    },
    body: JSON.stringify(data)
})
```

---

## üõ†Ô∏è Ferramentas de Debug

### 1. Script de Teste Completo

```python
#!/usr/bin/env python3
"""
Script de teste e diagn√≥stico para MRP Avan√ßado
"""

import requests
import json
from datetime import datetime, timedelta

def test_mrp_advanced():
    # Dados de teste b√°sicos
    test_data = {
        "sporadic_demand": {
            "2025-07-01": 1000,
            "2025-08-01": 1500,
            "2025-09-01": 2000
        },
        "initial_stock": 500,
        "leadtime_days": 30,
        "period_start_date": "2025-06-01",
        "period_end_date": "2025-10-31",
        "start_cutoff_date": "2025-06-01",
        "end_cutoff_date": "2025-10-31"
    }
    
    try:
        response = requests.post(
            'http://localhost:5000/mrp_advanced',
            json=test_data,
            timeout=30
        )
        
        print(f"Status: {response.status_code}")
        
        if response.status_code == 200:
            result = response.json()
            print("‚úÖ Teste bem-sucedido!")
            print(f"Lotes criados: {len(result['batches'])}")
            print(f"Taxa de atendimento: {result['analytics']['summary']['demand_fulfillment_rate']}%")
        else:
            print(f"‚ùå Erro: {response.text}")
            
    except Exception as e:
        print(f"‚ùå Exce√ß√£o: {e}")

if __name__ == "__main__":
    test_mrp_advanced()
```

### 2. Validador de Entrada

```python
def validate_mrp_input(data):
    """Valida entrada para MRP Avan√ßado"""
    
    errors = []
    
    # Campos obrigat√≥rios
    required_fields = [
        'sporadic_demand', 'initial_stock', 'leadtime_days',
        'period_start_date', 'period_end_date'
    ]
    
    for field in required_fields:
        if field not in data:
            errors.append(f"Campo obrigat√≥rio ausente: {field}")
    
    # Valida√ß√µes espec√≠ficas
    if 'sporadic_demand' in data:
        if not isinstance(data['sporadic_demand'], dict):
            errors.append("sporadic_demand deve ser um objeto")
        elif len(data['sporadic_demand']) == 0:
            errors.append("sporadic_demand n√£o pode estar vazio")
    
    if 'leadtime_days' in data:
        if not isinstance(data['leadtime_days'], (int, float)):
            errors.append("leadtime_days deve ser num√©rico")
        elif data['leadtime_days'] <= 0:
            errors.append("leadtime_days deve ser > 0")
    
    return errors

# Uso
errors = validate_mrp_input(your_data)
if errors:
    for error in errors:
        print(f"‚ùå {error}")
```

---

## üìû Suporte T√©cnico

### Quando Contatar o Suporte

1. **üö® Cr√≠tico**: Sistema indispon√≠vel ou dados corrompidos
2. **‚ö†Ô∏è Alto**: Resultados incorretos consistentes
3. **üìã M√©dio**: Performance degradada ou recursos n√£o funcionam
4. **üí° Baixo**: D√∫vidas sobre configura√ß√£o ou otimiza√ß√£o

### Informa√ß√µes para o Suporte

Sempre inclua:
- **üìä Dados de entrada**: JSON completo usado
- **üñ•Ô∏è Ambiente**: Vers√£o do Python, SO, RAM dispon√≠vel
- **‚è∞ Timestamp**: Quando o problema ocorreu
- **üìù Logs**: Mensagens de erro completas
- **üéØ Comportamento esperado**: O que deveria acontecer

### Template de Report

```markdown
## üêõ Bug Report - Sistema MRP Avan√ßado

**üìÖ Data/Hora**: 2025-06-30 22:15:00
**üîó Endpoint**: /mrp_advanced
**üñ•Ô∏è Ambiente**: Python 3.9, Windows 10, 16GB RAM

### Problema
Descreva o problema aqui...

### Dados de Entrada
```json
{
    // Cole o JSON completo aqui
}
```

### Comportamento Atual
O que est√° acontecendo...

### Comportamento Esperado
O que deveria acontecer...

### Logs de Erro
```
Cole os logs aqui...
```
```

---

*Guia atualizado em: 30 de Junho de 2025* 